<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cards Against Trujillo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Base styles for the body */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0; /* Light text */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow-y: auto; /* Allow vertical scrolling for the whole page */
            flex-direction: column;
        }

        /* General container for the game */
        .game-container {
            width: 100%;
            max-width: 1200px; /* Limit max width for better readability */
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            padding: 1.5rem; /* Increased padding */
            box-sizing: border-box;
            background-color: rgba(45, 55, 72, 0.95); /* Slightly lighter container background with opacity */
            border-radius: 1.5rem; /* More rounded corners */
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4), 0 0 25px rgba(66, 153, 225, 0.3); /* Enhanced shadow with blue glow */
            position: relative;
            backdrop-filter: blur(5px); /* Subtle blur effect for background elements */
            border: 1px solid rgba(66, 153, 225, 0.5); /* Subtle blue border */
        }

        /* Card container base style */
        .card-container {
            /* Cards are now bigger */
            width: 180px; 
            height: 250px; 
            background-color: #4a5568;
            border: 2px solid #a0aec0;
            border-radius: 0.75rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out, border-color 0.2s ease-out, opacity 0.3s ease-out;
            position: relative;
            user-select: none;
            flex-shrink: 0;
            font-family: 'Roboto Mono', monospace;
            overflow: hidden; /* Ensure content stays within borders */
        }

        .card-container:hover {
            transform: translateY(-8px) scale(1.02); /* Slight scale on hover */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4), 0 0 20px #63b3ed; /* More intense glow */
            border-color: #63b3ed;
        }

        .card-container.selected {
            border-color: #63b3ed;
            transform: translateY(-12px) scale(1.08); /* More pronounced scale when selected */
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5), 0 0 30px #4299e1; /* Stronger glow */
        }

        /* -- IMAGE CARD STYLES -- */
        .card-image {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Ensures the image covers the card area */
            border-radius: 0.55rem; /* Slightly smaller than container to fit inside padding */
        }

        .card-container .card-header,
        .card-container .card-art,
        .card-container .card-body,
        .card-container .card-footer {
            display: none; /* Hide the old text elements */
        }
        /* -- END IMAGE CARD STYLES -- */


        /* Animations for player card being played */
        @keyframes playerPlayCard {
            0% { transform: translate(0, 0) rotate(0deg); opacity: 1; }
            50% { transform: translate(0, -100px) rotate(10deg) scale(1.1); opacity: 1; filter: brightness(1.2); }
            100% { transform: translate(0, -200px) rotate(20deg) scale(0.5); opacity: 0; filter: brightness(0.5); }
        }

        .player-card-played {
            animation: playerPlayCard 0.7s ease-out forwards;
        }

        /* Animation for opponent cards revealing and fading */
        @keyframes revealAndFade {
            0% {
                transform: translate(-50%, -50%) scale(0.1) rotateY(90deg); /* Starts very small, flipped */
                opacity: 0;
                filter: blur(10px);
            }
            20% {
                transform: translate(-50%, -50%) scale(1.1) rotateY(0deg); /* Flips open, slightly larger */
                opacity: 1;
                filter: blur(0);
            }
            80% {
                transform: translate(-50%, -50%) scale(1); /* Holds visible, shrinks to normal */
                opacity: 1;
                filter: blur(0);
            }
            100% {
                transform: translate(-50%, -50%) scale(0.8); /* Shrinks slightly before disappearing */
                opacity: 0;
                filter: blur(5px);
            }
        }

        .opponent-card-revealed {
            animation: revealAndFade 2.5s ease-out forwards; /* Longer duration for dramatic effect */
        }

        /* Animation for new cards being drawn */
        @keyframes cardDrawFadeIn {
            from { opacity: 0; transform: translateY(20px) scale(0.8); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .card-draw-animation {
            animation: cardDrawFadeIn 0.5s ease-out forwards;
            animation-delay: var(--card-delay, 0s); /* Use CSS variable for staggered delay */
        }

        /* Opponent card styling */
        .card-container.opponent-card {
            background-color: #5a67d8;
            border-color: #8da4f7;
            transform: none !important;
            cursor: default;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Slightly stronger shadow */
        }

        /* Card internal elements */
        .card-header {
            font-weight: 700;
            text-align: center;
            font-size: 0.9rem; /* Slightly larger for emphasis */
            color: #e2e8f0;
            line-height: 1.2;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5); /* Text shadow for readability */
        }
        
        .card-art {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 4px;
        }
        
        .card-art svg {
            width: 80%; /* Adjust SVG size */
            max-height: 40px; /* Max height for icons */
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.3)); /* Subtle glow on icons */
        }

        .card-body {
            font-size: 0.75rem; /* Adjusted for readability on larger card */
            text-align: center;
            color: #cbd5e0;
            line-height: 1.4; /* Increased line height */
            overflow-y: auto; /* Enable vertical scrolling */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            flex-grow: 1; /* Allow the body to take available space */
            padding: 0 4px; /* Space for scrollbar */
            box-sizing: border-box; /* Include padding in width/height */
        }

        /* Custom scrollbar styles for card-body */
        .card-body::-webkit-scrollbar {
            width: 6px; /* Wider scrollbar */
        }

        .card-body::-webkit-scrollbar-thumb {
            background-color: rgba(99, 179, 237, 0.5); /* Blueish semi-transparent */
            border-radius: 3px;
        }

        .card-body::-webkit-scrollbar-track {
            background-color: rgba(0,0,0,0.1);
        }

        .card-footer {
            font-size: 0.85rem; /* Adjusted for readability on larger card */
            color: #cbd5e0;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        /* Hand displays */
        .player-hand, .opponent-hand {
            display: flex;
            justify-content: center;
            gap: 1rem; /* Increased gap between cards */
            flex-wrap: wrap;
            min-height: 280px; /* Adjusted to fit larger cards and animations */
            align-items: flex-end; /* Align cards to the bottom of the hand area */
            position: relative; /* For z-index and animations */
        }

        /* Area for played cards (opponent's specifically) */
        .played-card-area {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none; /* Allows clicks to pass through */
            z-index: 50; /* Ensure played card is above others */
        }

        /* Facedown card styling (removed, opponent cards will be visible) */
        .facedown-card {
            display: none !important; /* Hide facedown cards */
        }

        /* Status bar general style */
        .status-bar {
            height: 25px; /* Slightly taller */
            background-color: #3b4454; /* Darker background for bar */
            border-radius: 0.75rem; /* More rounded */
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* Fill for suspicion/strength */
        .suspicion-fill {
            height: 100%;
            background-color: #e53e3e; /* Red for suspicion/strength */
            transition: width 0.5s ease-out, background-color 0.3s ease-out;
            border-radius: 0.75rem; /* Inherit rounded corners */
        }

        /* Fill for supplies */
        .supplies-fill {
            height: 100%;
            background-color: #48bb78; /* Green for supplies */
            transition: width 0.5s ease-out, background-color 0.3s ease-out;
            border-radius: 0.75rem; /* Inherit rounded corners */
        }
        
        /* Pulse animation for status bars */
        @keyframes pulseRed {
            0% { box-shadow: 0 0 0px rgba(229,62,62,0.7); }
            50% { box-shadow: 0 0 8px rgba(229,62,62,1); }
            100% { box-shadow: 0 0 0px rgba(229,62,62,0.7); }
        }
        @keyframes pulseGreen {
            0% { box-shadow: 0 0 0px rgba(72,187,120,0.7); }
            50% { box-shadow: 0 0 8px rgba(72,187,120,1); }
            100% { box-shadow: 0 0 0px rgba(72,187,120,0.7); }
        }
        .suspicion-fill.pulse { animation: pulseRed 0.8s ease-in-out; }
        .supplies-fill.pulse { animation: pulseGreen 0.8s ease-in-out; }

        .status-text {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.9rem; /* Slightly larger font */
            font-weight: bold;
            color: #cbd5e0;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.9); /* Stronger shadow */
            z-index: 1; /* Ensure text is above fill */
        }

        /* Turn button styling */
        .turn-button {
            background-color: #4299e1;
            color: white;
            padding: 0.85rem 1.75rem; /* Increased padding */
            border-radius: 0.6rem; /* More rounded */
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.15s ease-out, box-shadow 0.2s ease-in-out;
            box-shadow: 0 6px 12px rgba(0,0,0,0.3); /* Enhanced shadow */
            font-size: 1.2rem; /* Larger font */
            border: none; /* Remove default border */
            outline: none; /* Remove outline on focus */
            background-image: linear-gradient(to bottom right, #4299e1, #2b6cb0); /* Gradient */
        }

        .turn-button:hover:not(:disabled) {
            background-color: #3182ce;
            transform: translateY(-3px) scale(1.02); /* More pronounced lift and scale */
            box-shadow: 0 8px 16px rgba(0,0,0,0.4), 0 0 20px #63b3ed;
            background-image: linear-gradient(to bottom right, #3182ce, #2c5282); /* Darker gradient on hover */
        }

        .turn-button:active:not(:disabled) {
            transform: translateY(0px) scale(0.98); /* Press down effect */
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }

        .turn-button:disabled {
            background-color: #4a5568;
            cursor: not-allowed;
            opacity: 0.6;
            box-shadow: none;
            background-image: none; /* Remove gradient when disabled */
        }

        /* Message box for start/end game */
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(45, 55, 72, 0.98); /* Slightly more opaque */
            border: 2px solid #4299e1;
            border-radius: 1.5rem; /* More rounded */
            padding: 2.5rem; /* Increased padding */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.7), 0 0 30px rgba(66, 153, 225, 0.5); /* Stronger shadows and glow */
            z-index: 1000;
            text-align: center;
            color: #e2e8f0;
            font-size: 1.3rem; /* Larger font */
            font-weight: bold;
            display: flex;
            flex-direction: column;
            gap: 1.5rem; /* Increased gap */
            animation: fadeIn 0.5s ease-out; /* Longer fade in */
            backdrop-filter: blur(8px); /* More blur for message box */
            width: 90%; /* Responsive width */
            max-width: 500px; /* Max width */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -60%); filter: blur(10px); }
            to { opacity: 1; transform: translate(-50%, -50%); filter: blur(0); }
        }

        .message-box button {
            background-color: #4299e1;
            color: white;
            padding: 0.85rem 1.75rem;
            border-radius: 0.6rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.15s ease-out;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            background-image: linear-gradient(to bottom right, #4299e1, #2b6cb0);
        }

        .message-box button:hover {
            background-color: #3182ce;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
            background-image: linear-gradient(to bottom right, #3182ce, #2c5282);
        }

        .message-box button:active {
            transform: translateY(0px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .hidden {
            display: none !important;
        }

        /* Styling for player and opponent names/avatars */
        .player-info, .opponent-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
            position: relative; /* For absolute positioning of glyphs */
            z-index: 10; /* Ensure info is above glyphs */
        }

        .player-info .avatar, .opponent-info .avatar {
            width: 60px; /* Increased size for profile pictures */
            height: 60px; /* Increased size for profile pictures */
            border-radius: 50%;
            background-color: #63b3ed; /* Default avatar background */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            flex-shrink: 0; /* Prevent shrinking */
            overflow: hidden; /* Ensure image is clipped to circle */
        }

        .player-info .avatar img, .opponent-info .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Ensure image fills the circular frame */
        }

        .opponent-info .avatar {
            background-color: #e53e3e; /* Red for opponent */
        }

        .game-message {
            margin-top: 1rem;
            padding: 0.75rem;
            border-radius: 0.75rem;
            font-style: italic;
            font-size: 1rem;
            text-align: center;
            background-color: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255,255,255,0.1);
            color: #b2f5ea; /* Teal color for messages */
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            animation: messageFadeIn 0.5s ease-out;
        }

        @keyframes messageFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* New styles for deck and discard pile visuals */
        .deck-visual, .discard-visual {
            width: 120px; /* Slightly larger visual card */
            height: 160px;
            margin-bottom: 0.5rem;
            background-image: linear-gradient(135deg, #5a67d8, #4299e1); /* Blue gradient for deck */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3), 
                        -3px 3px 5px rgba(0, 0, 0, 0.2), /* Stack effect */
                        -6px 6px 8px rgba(0, 0, 0, 0.1);
            transform: rotateZ(-5deg) rotateY(5deg); /* Slight 3D tilt */
            transition: all 0.2s ease-out;
            cursor: default; /* Not interactive */
            font-size: 1.5rem; /* Size of '?' */
            color: rgba(255,255,255,0.4);
            border: 2px solid #8da4f7;
            border-radius: 0.75rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .discard-visual {
            background-image: linear-gradient(135deg, #a0aec0, #718096); /* Grey gradient for discard */
            transform: rotateZ(5deg) rotateY(-5deg); /* Opposite tilt */
            border: 2px solid #cbd5e0;
        }

        .deck-visual::before, .discard-visual::before {
            content: 'DECK'; /* Text for deck */
            font-size: 0.9rem;
            font-weight: bold;
            color: rgba(255,255,255,0.6);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            transform: rotateZ(5deg); /* Counter-rotate text */
        }
        .discard-visual::before {
            content: 'DISCARD'; /* Text for discard */
            transform: rotateZ(-5deg); /* Counter-rotate text */
        }

        /* Abstract background glyphs */
        .bg-glyph-opponent {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 80px;
            height: 80px;
            color: #e53e3e; /* Red tint */
            opacity: 0.05; /* Very subtle */
            transform: rotate(20deg);
            z-index: 0; /* Ensure it's in the background */
            pointer-events: none;
        }

        .bg-glyph-player {
            position: absolute;
            bottom: 10px;
            left: 10px;
            width: 80px;
            height: 80px;
            color: #63b3ed; /* Blue tint */
            opacity: 0.05; /* Very subtle */
            transform: rotate(-20deg);
            z-index: 0; /* Ensure it's in the background */
            pointer-events: none;
        }


        /* Responsive adjustments */
        @media (max-width: 768px) {
            .game-container {
                padding: 1rem;
                gap: 1rem;
            }
            .card-container {
                width: 140px; /* Adjusted for mobile */
                height: 200px; /* Adjusted for mobile */
                padding: 0.4rem;
            }
            .facedown-card {
                width: 140px;
                height: 200px;
            }
            .card-header {
                font-size: 0.75rem;
            }
            .card-body {
                font-size: 0.65rem;
                line-height: 1.3;
            }
            .card-footer {
                font-size: 0.7rem;
            }
            .player-hand, .opponent-hand {
                gap: 0.75rem;
                min-height: 220px; /* Adjusted for larger mobile cards */
            }
            .turn-button {
                padding: 0.6rem 1.2rem;
                font-size: 1rem;
            }
            .message-box {
                width: 95%;
                font-size: 1rem;
                padding: 1.5rem;
            }
            .player-info .avatar, .opponent-info .avatar {
                width: 40px; /* Adjusted for mobile */
                height: 40px; /* Adjusted for mobile */
                font-size: 1.2rem;
            }
            h1 {
                font-size: 2rem !important; /* Smaller title on mobile */
            }
            h2 {
                font-size: 1.5rem !important; /* Smaller section titles on mobile */
            }
            .status-text {
                font-size: 0.7rem;
            }
            .deck-visual, .discard-visual {
                width: 90px; /* Adjusted for mobile */
                height: 120px; /* Adjusted for mobile */
            }
            .deck-visual::before, .discard-visual::before {
                font-size: 0.7rem;
            }
            .bg-glyph-opponent, .bg-glyph-player {
                width: 60px;
                height: 60px;
            }
        }
    </style>
</head>
<body class="selection:bg-blue-400 selection:text-white">
    <div id="gameScreen" class="game-container hidden">
        <div class="flex justify-between items-center mb-4">
            <h1 id="gameTitle" class="text-3xl font-bold text-blue-300 drop-shadow-lg">Cards Against Trujillo</h1>
            <div id="turnInfo" class="text-xl font-semibold text-yellow-300 text-shadow-md">Turn: 1</div>
        </div>

        <div class="bg-gray-800 p-5 rounded-xl shadow-lg border border-red-500/30 relative overflow-hidden">
            <svg class="bg-glyph-opponent" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zM17.79 8.21C17.92 8.79 18 9.38 18 10c0 4.08-3.05 7.44-7 7.93V16c0-1.1-.9-2-2-2v-1l4.79-4.79c.63-.63.18-1.71-.71-1.71H14c-1.1 0-2-.9-2-2V7c0-.55.45-1 1-1h2c.37 0 .7.21.87.52l.13.27c.2.45.64.73 1.13.73.53 0 1.02-.3 1.22-.76.22-.51.04-1.11-.42-1.39z"/>
            </svg>
            
            <div class="opponent-info">
                <!-- Opponent profile picture -->
                <div class="avatar">
                    <img src="dictator.jpeg" alt="Dictator Profile Picture" onerror="this.onerror=null;this.src='https://placehold.co/60x60/e53e3e/ffffff?text=D';">
                </div>
                <h2 id="opponentName" class="text-2xl font-semibold text-red-400">Opponent: Trujillo</h2>
            </div>
            <div class="flex items-center gap-4 mb-2">
                <span class="font-bold text-gray-200">Regime Strength:</span>
                <div class="flex-grow status-bar">
                    <div id="opponentStrengthBar" class="suspicion-fill" style="width: 100%;"></div>
                    <span id="opponentStrengthText" class="status-text">100%</span>
                </div>
            </div>
            <div id="opponentHand" class="opponent-hand">
                <div id="opponentPlayedCardArea" class="played-card-area"></div>
            </div>
            <div id="opponentMessage" class="game-message">The regime waits for your response...</div>
        </div>

        <div class="bg-gray-800 p-5 rounded-xl shadow-lg border border-blue-500/30 relative overflow-hidden">
            <svg class="bg-glyph-player" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/>
            </svg>

            <div class="player-info">
                <!-- Player profile picture -->
                <div class="avatar">
                    <img src="butterfly.jpeg" alt="Butterfly Profile Picture" onerror="this.onerror=null;this.src='https://placehold.co/60x60/63b3ed/ffffff?text=B';">
                </div>
                <h2 class="text-2xl font-semibold text-blue-400">Player: You (The Butterflies)</h2>
            </div>
            <div class="flex items-center gap-4 mb-2">
                <span class="font-bold text-gray-200">Suspicion:</span>
                <div class="flex-grow status-bar">
                    <div id="playerSuspicionBar" class="suspicion-fill" style="width: 0%;"></div>
                    <span id="playerSuspicionText" class="status-text">0%</span>
                </div>
            </div>
            <div class="flex items-center gap-4 mb-4">
                <span class="font-bold text-gray-200">Supplies:</span>
                <div class="flex-grow status-bar">
                    <div id="playerSuppliesBar" class="supplies-fill" style="width: 100%;"></div>
                    <span id="playerSuppliesText" class="status-text">100 / 100</span>
                </div>
            </div>
            <div id="playerHand" class="player-hand">
                </div>
            <div class="flex justify-center mt-4 gap-4">
                <button id="playCardButton" class="turn-button" disabled>Play Selected Card</button>
                <button id="endTurnButton" class="turn-button">End Turn</button>
            </div>
            <div id="playerMessage" class="game-message">Your turn. Select a card to play or end your turn.</div>
            
            <div class="flex justify-center mt-4 text-gray-400 text-sm items-center">
                <div class="flex flex-col items-center mr-6">
                    <div id="playerDeckVisual" class="deck-visual"></div>
                    <span>Deck: <span id="playerDeckCount" class="font-bold">0</span></span>
                </div>
                <div class="flex flex-col items-center ml-6">
                    <div id="playerDiscardVisual" class="discard-visual"></div>
                    <span>Discard: <span id="playerDiscardCount" class="font-bold">0</span></span>
                </div>
            </div>
        </div>
    </div>

    <div id="startScreen" class="message-box">
        <h2 class="text-4xl font-bold text-blue-300 mb-6 drop-shadow-lg">Cards Against Trujillo</h2>
        <p class="mb-8 leading-relaxed">
            It is the time of the butterflies. As a member of the Mirabal sisters' resistance, you must stand against the brutal regime of Rafael Trujillo. Use your wits, courage, and solidarity to dismantle his strength before his suspicion of you becomes your undoing.
        </p>
        <button id="startButton">Start Game</button>
    </div>

    <div id="messageBox" class="message-box hidden">
        <p id="messageText" class="text-xl leading-relaxed"></p>
        <button id="messageBoxButton"></button>
    </div>

    <!-- Background Music -->
    <audio id="backgroundMusic" loop>
        <source src="main-theme.ogg" type="audio/ogg">
        Your browser does not support the audio element.
    </audio>

    <script>
        // --- Game Constants ---
        const MAX_SUPPLIES = 100;
        const MAX_PLAYER_SUSPICION = 100; // Player's personal suspicion limit
        const MAX_REGIME_STRENGTH = 100; // Trujillo Regime's starting strength
        const START_HAND_SIZE = 5;
        const MAX_HAND_SIZE = 7;
        const DRAW_PER_TURN = 1;
        
        // UPDATED: This now points to your specific GitHub repository.
        const IMAGE_BASE_URL = "https://raw.githubusercontent.com/taucetie78/butterfly-card-game/main/";


        // --- DOM Elements ---
        const gameScreen = document.getElementById('gameScreen');
        const startScreen = document.getElementById('startScreen'); 
        const startButton = document.getElementById('startButton');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const messageBoxButton = document.getElementById('messageBoxButton');

        const gameTitle = document.getElementById('gameTitle');
        const turnInfo = document.getElementById('turnInfo');
        const opponentName = document.getElementById('opponentName');
        const opponentStrengthBar = document.getElementById('opponentStrengthBar');
        const opponentStrengthText = document.getElementById('opponentStrengthText');
        const opponentHandElement = document.getElementById('opponentHand');
        const opponentMessageElement = document.getElementById('opponentMessage');
        const opponentPlayedCardArea = document.getElementById('opponentPlayedCardArea');

        const playerSuspicionBar = document.getElementById('playerSuspicionBar');
        const playerSuspicionText = document.getElementById('playerSuspicionText');
        const playerSuppliesBar = document.getElementById('playerSuppliesBar');
        const playerSuppliesText = document.getElementById('playerSuppliesText');
        const playerHandElement = document.getElementById('playerHand');
        const playCardButton = document.getElementById('playCardButton');
        const endTurnButton = document.getElementById('endTurnButton');
        const playerMessageElement = document.getElementById('playerMessage');

        const playerDeckCountElement = document.getElementById('playerDeckCount');
        const playerDiscardCountElement = document.getElementById('playerDiscardCount');
        const playerDeckVisualElement = document.getElementById('playerDeckVisual');
        const playerDiscardVisualElement = document.getElementById('playerDiscardVisual');

        const backgroundMusic = document.getElementById('backgroundMusic');


        // --- Game State Variables ---
        let currentTurn = 0;
        let gameActive = false;
        let selectedPlayerCard = null;
        let currentOpponentType = null;

        // --- Game Instance Variables ---
        let player = null;
        let opponent = null;

        // --- Card Data ---
        // UPDATED: The 'art' property now matches your exact PNG filenames.
        const allCards = [
            // Player Cards
            { id: 'p01', name: 'Minor Truth', cost: 5, effects: [{ target: 'player', stat: 'suspicion', value: -10 }], art: 'minortruth.png' },
            { id: 'p02', name: 'Strategic Silence', cost: 8, effects: [{ target: 'opponent', stat: 'strength', value: -15 }, { target: 'player', stat: 'supplies', value: -5 }], art: 'Strategicsilence.png' },
            { id: 'p03', name: 'Observe', cost: 0, effects: [{ target: 'player', stat: 'supplies', value: 20 }], art: 'Observe.png' },
            { id: 'p04', name: 'Half-Truth', cost: 12, effects: [{ target: 'player', stat: 'suspicion', value: -15 }, { target: 'opponent', stat: 'strength', value: -5 }], art: 'Halftruth.png' },
            { id: 'p05', name: 'Calculated Deception', cost: 15, effects: [{ target: 'opponent', stat: 'strength', value: -25 }, { target: 'player', stat: 'supplies', value: -10 }], art: 'calculateddeception.png' },
            { id: 'p06', name: 'Hidden Resource', cost: 0, effects: [{ target: 'player', stat: 'supplies', value: 35 }], art: 'Hiddenresources.png' },
            { id: 'p07', name: 'Confession', cost: 10, effects: [{ target: 'player', stat: 'suspicion', value: -25 }, { target: 'player', stat: 'supplies', value: -10 }], art: 'confession.png' },
            { id: 'p08', name: 'Provoke Response', cost: 18, effects: [{ target: 'opponent', stat: 'strength', value: -20 }], art: 'provokeresponse.png' },
            { id: 'p09', name: 'Plausible Deniability', cost: 10, effects: [{ target: 'opponent', stat: 'strength', value: -10 }], art: 'plausibledeniability.png' },
            { id: 'p10', name: 'Diversion', cost: 7, effects: [{ target: 'opponent', stat: 'strength', value: -10 }], art: 'diversion.png' },
            { id: 'p11', name: 'True Revelation', cost: 20, effects: [{ target: 'player', stat: 'suspicion', value: -30 }], art: 'truerevelation.png' },
            { id: 'p12', name: 'Strategic Delay', cost: 0, effects: [{ target: 'player', stat: 'supplies', value: 15 }, { target: 'opponent', stat: 'strength', value: -5 }], art: 'strategicdelay.png' },
            { id: 'p13', name: 'Sisterhood Bond', cost: 10, effects: [{ target: 'player', stat: 'suspicion', value: -15 }, { target: 'player', stat: 'supplies', value: 10 }], art: 'sisterhoodbond.png' },
            { id: 'p14', name: 'Underground Press', cost: 5, effects: [{ target: 'player', stat: 'supplies', value: 25 }, { target: 'opponent', stat: 'strength', value: -5 }], art: 'undergroundpress.png' },
            { id: 'p15', name: 'Act of Defiance', cost: 20, effects: [{ target: 'opponent', stat: 'strength', value: -30 }, { target: 'player', stat: 'suspicion', value: 10 }], art: 'actofdefiance.png' },
            { id: 'p16', name: 'Secret Meeting', cost: 0, effects: [{ target: 'player', stat: 'supplies', value: -15 }], drawExtra: 1, art: 'secretmeeting.png' },
            { id: 'p18', name: 'The Fourth Butterfly', cost: 25, effects: [{ target: 'player', stat: 'suspicion', value: -50 }, { target: 'player', stat: 'supplies', value: -25 }], art: 'thefourthbutterfly.png' },
            
            // Opponent Cards
            { id: 'e01_police', name: 'Interrogate', effects: [{ target: 'player', stat: 'suspicion', value: 15 }], art: 'Interrogate.png' },
            { id: 'e02_police', name: 'Scrutinize', effects: [{ target: 'player', stat: 'suspicion', value: 10 }], art: 'scrutinize.png' },
            { id: 'e03_police', name: 'Demand Info', effects: [{ target: 'player', stat: 'suspicion', value: 20 }], art: 'demandinfo.png' },
            { id: 'e04_police', name: 'Gather Evidence', effects: [{ target: 'opponent', stat: 'supplies', value: 20 }], art: 'gatherevidence.png' },
            { id: 'e05_police', name: 'False Lead', effects: [{ target: 'opponent', stat: 'strength', value: 10 }], art: 'falselead.png' },
            { id: 'e06_police', name: 'Secret Police Raid', effects: [{ target: 'player', stat: 'suspicion', value: 25 }], art: 'secretpoliceraid.png' },
            { id: 'e07_police', name: 'Propaganda Broadcast', effects: [{ target: 'player', stat: 'suspicion', value: 10 }, { target: 'opponent', stat: 'strength', value: 5 }], art: 'propagandabroadcast.png' },
            { id: 'e08_police', name: 'Surveillance Net', effects: [{ target: 'player', stat: 'supplies', value: -10 }], art: 'surveillancenet.png' },
        ];


        // --- Player and Opponent Data Structures ---
        class Character {
            constructor(name, isPlayer = false) {
                this.name = name;
                this.isPlayer = isPlayer;
                this.suspicion = isPlayer ? 0 : MAX_REGIME_STRENGTH; 
                this.supplies = MAX_SUPPLIES;
                this.hand = [];
                this.deck = [];
                this.discardPile = [];
            }

            drawCard(num = DRAW_PER_TURN) {
                const drawnCards = [];
                for (let i = 0; i < num; i++) {
                    if (this.deck.length === 0) {
                        if (this.discardPile.length > 0) {
                            this.shuffleDiscardIntoDeck();
                            playerMessageElement.textContent = `Shuffling discard into deck.`;
                        } else {
                            console.warn(`${this.name}'s deck and discard pile are empty. Cannot draw.`);
                            break;
                        }
                    }
                    if (this.hand.length < MAX_HAND_SIZE && this.deck.length > 0) {
                        const cardIndex = Math.floor(Math.random() * this.deck.length);
                        const card = this.deck.splice(cardIndex, 1)[0];
                        this.hand.push(card);
                        drawnCards.push(card);
                    } else if (this.hand.length >= MAX_HAND_SIZE) {
                        console.log(`${this.name}'s hand is full.`);
                        break;
                    }
                }
                return drawnCards;
            }

            shuffleDeck() {
                for (let i = this.deck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this.deck[i], this.deck[j]] = [this.deck[j], this.deck[i]];
                }
            }

            shuffleDiscardIntoDeck() {
                this.deck = [...this.discardPile];
                this.discardPile = [];
                this.shuffleDeck();
            }
        }

        class Player extends Character {
            constructor() {
                super('Player', true);
                this.deck = [...allCards.filter(card => card.id.startsWith('p'))];
                this.shuffleDeck();
            }
        }

        class Opponent extends Character {
            constructor(name, cardType) {
                super(name, false);
                this.cardType = cardType;
                this.deck = [...allCards.filter(card => card.id.includes(`_${this.cardType}`))];
                this.shuffleDeck();
            }

            chooseCard(playerChar) {
                let bestCard = null;
                let bestScore = -Infinity;
                const playableCards = this.hand;

                if (playableCards.length === 0) return null;

                for (const card of playableCards) {
                    let score = 0;
                    const playerSuspicionIncrease = card.effects.reduce((sum, eff) => (eff.target === 'player' && eff.stat === 'suspicion' && eff.value > 0) ? sum + eff.value : sum, 0);
                    const playerSuppliesDecrease = card.effects.reduce((sum, eff) => (eff.target === 'player' && eff.stat === 'supplies' && eff.value < 0) ? sum + Math.abs(eff.value) : sum, 0);
                    const opponentStrengthIncrease = card.effects.reduce((sum, eff) => (eff.target === 'opponent' && eff.stat === 'strength' && eff.value > 0) ? sum + eff.value : sum, 0);

                    score += playerSuspicionIncrease * 2;
                    score += playerSuppliesDecrease;
                    score += opponentStrengthIncrease * 1.5;

                    if (playerChar.suspicion > MAX_PLAYER_SUSPICION * 0.7) { 
                        score += playerSuspicionIncrease * 3;
                    }

                    if (this.suspicion < MAX_REGIME_STRENGTH * 0.3) { 
                        score += opponentStrengthIncrease * 3;
                    }

                    if (score > bestScore) {
                        bestScore = score;
                        bestCard = card;
                    }
                }

                if (!bestCard && playableCards.length > 0) {
                    bestCard = playableCards[Math.floor(Math.random() * playableCards.length)];
                } else if (!bestCard) {
                    return null;
                }
                return bestCard;
            }
        }

        // --- Game Flow Functions ---
        function startGame() {
            player = new Player();
            currentOpponentType = 'police';
            opponent = new Opponent('Trujillo', currentOpponentType);
            
            gameActive = true;
            currentTurn = 1;
            selectedPlayerCard = null;
            
            player.drawCard(START_HAND_SIZE);
            opponent.drawCard(START_HAND_SIZE);

            document.getElementById('startScreen').classList.add('hidden');
            gameScreen.classList.remove('hidden');

            // Play background music
            backgroundMusic.play().catch(e => console.log("Music play failed:", e));

            startTurn();
        }

        function startTurn() {
             if (currentTurn > 1) {
                const drawnCards = player.drawCard(DRAW_PER_TURN);
                if (drawnCards.length > 0) {
                     playerMessageElement.textContent = `You drew a card. Your turn. Select a card to play or end your turn.`;
                } else {
                    playerMessageElement.textContent = `Your hand is full or deck is empty. Your turn. Select a card to play or end your turn.`;
                }
            } else {
                playerMessageElement.textContent = 'Welcome! Select a card to play or end your turn.';
            }
            
            opponentMessageElement.textContent = 'The regime waits for your response...';
            
            updateUI(true);
            if (checkGameOver()) return;

            playCardButton.disabled = (selectedPlayerCard === null);
            endTurnButton.disabled = false;
        }

        function endTurn() {
            if (!gameActive) return;
            endTurnButton.disabled = true;
            playCardButton.disabled = true;
            selectedPlayerCard = null;

            playerMessageElement.textContent = 'You ended your turn.';
            opponentMessageElement.textContent = `${opponent.name} is considering their move...`;
            
            setTimeout(opponentTurn, 2000);
        }

        async function opponentTurn() {
            if (!gameActive) return;

            opponent.drawCard(DRAW_PER_TURN);
            const cardToPlay = opponent.chooseCard(player);

            if (cardToPlay) {
                const cardIndex = opponent.hand.findIndex(c => c.id === cardToPlay.id);
                const playedCard = opponent.hand.splice(cardIndex, 1)[0];
                opponent.discardPile.push(playedCard);
                
                const cardElement = renderCard(playedCard, false);
                cardElement.style.position = 'absolute';
                cardElement.style.top = '50%';
                cardElement.style.left = '50%';
                cardElement.style.transform = 'translate(-50%, -50%)';
                cardElement.style.zIndex = '100';
                
                opponentPlayedCardArea.innerHTML = '';
                opponentPlayedCardArea.appendChild(cardElement);

                requestAnimationFrame(() => { 
                    cardElement.classList.add('opponent-card-revealed');
                });

                applyCardEffects(playedCard);
                opponentMessageElement.textContent = `${opponent.name} played "${playedCard.name}"!`;
                
                updateUI();

                await new Promise(resolve => setTimeout(resolve, 2500));

                cardElement.remove();

            } else {
                opponentMessageElement.textContent = `${opponent.name} has no playable cards and passes.`;
                await new Promise(resolve => setTimeout(resolve, 1500));
            }
            
            opponentPlayedCardArea.innerHTML = '';

            currentTurn++;
            turnInfo.textContent = `Turn: ${currentTurn}`;
            startTurn();
        }

        function playSelectedCard() {
            if (!selectedPlayerCard || !gameActive) return;

            const card = selectedPlayerCard.cardData;
            if (player.supplies < card.cost) {
                playerMessageElement.textContent = 'Not enough supplies to play this card!';
                playCardButton.classList.add('animate-pulse');
                setTimeout(() => playCardButton.classList.remove('animate-pulse'), 500);
                return;
            }

            player.supplies -= card.cost;

            const cardIndex = player.hand.findIndex(c => c.id === card.id);
            if (cardIndex > -1) {
                const playedCard = player.hand.splice(cardIndex, 1)[0];
                player.discardPile.push(playedCard);

                const cardElement = selectedPlayerCard.element;
                cardElement.classList.add('player-card-played');
                cardElement.style.pointerEvents = 'none'; 
                
                playerMessageElement.textContent = `You played "${playedCard.name}"!`;

                setTimeout(() => {
                    applyCardEffects(playedCard);
                    updateUI();
                    selectedPlayerCard = null;
                    playCardButton.disabled = true;
                    playerMessageElement.textContent += ' Select another card or end your turn.';

                    if (playedCard.drawExtra) {
                        player.drawCard(playedCard.drawExtra);
                        playerMessageElement.textContent += ` You drew ${playedCard.drawExtra} extra card(s)!`;
                        updateUI(true);
                    }

                }, 700);
            }
        }

        function applyCardEffects(card) {
            let changesMade = false;
            card.effects.forEach(effect => {
                let targetChar = null;
                if (effect.target === 'player') {
                    targetChar = player;
                } else if (effect.target === 'opponent') {
                    targetChar = opponent;
                }

                if (targetChar) {
                    let oldValue;
                    if (effect.stat === 'suspicion') {
                        oldValue = targetChar.suspicion;
                        targetChar.suspicion = Math.max(0, Math.min(targetChar.isPlayer ? MAX_PLAYER_SUSPICION : MAX_REGIME_STRENGTH, targetChar.suspicion + effect.value));
                    } else if (effect.stat === 'supplies' && targetChar.isPlayer) {
                        oldValue = targetChar.supplies;
                        targetChar.supplies = Math.max(0, Math.min(MAX_SUPPLIES, targetChar.supplies + effect.value));
                    } else if (effect.stat === 'strength' && !targetChar.isPlayer) {
                         oldValue = targetChar.suspicion; 
                         targetChar.suspicion = Math.max(0, Math.min(MAX_REGIME_STRENGTH, targetChar.suspicion + effect.value));
                    }

                    if (oldValue !== targetChar.suspicion || oldValue !== targetChar.supplies) {
                        changesMade = true;
                    }
                }
            });
            if (changesMade) {
                playerSuspicionBar.classList.remove('pulse');
                playerSuppliesBar.classList.remove('pulse');
                opponentStrengthBar.classList.remove('pulse');

                requestAnimationFrame(() => {
                    playerSuspicionBar.classList.add('pulse');
                    playerSuppliesBar.classList.add('pulse');
                    opponentStrengthBar.classList.add('pulse');
                });
            }
        }

        // --- UI Rendering and Updates ---
        function renderCard(card, isPlayerCard, index = 0) {
            const cardElement = document.createElement('div');
            cardElement.className = `card-container ${isPlayerCard ? '' : 'opponent-card'}`;
            
            if (isPlayerCard) {
                cardElement.classList.add('card-draw-animation');
                cardElement.style.setProperty('--card-delay', `${index * 0.1}s`);
            }
            
            const cardImage = document.createElement('img');
            cardImage.src = IMAGE_BASE_URL + card.art;
            cardImage.alt = card.name;
            cardImage.className = 'card-image';
            
            // The existing `innerHTML` for card parts is removed to ensure the image fully fills the card.
            // cardElement.innerHTML = `
            //     <div class="card-header"></div>
            //     <div class="card-art"></div>
            //     <div class="card-body"></div>
            //     <div class="card-footer"></div>
            // `;
            cardElement.appendChild(cardImage);


            if (isPlayerCard) {
                cardElement.addEventListener('click', () => selectCard(cardElement, card));
            }
            return cardElement;
        }

        function selectCard(element, cardData) {
            if (selectedPlayerCard && selectedPlayerCard.element) {
                selectedPlayerCard.element.classList.remove('selected');
            }

            selectedPlayerCard = { element: element, cardData: cardData };
            element.classList.add('selected');
            playCardButton.disabled = false; 
            playerMessageElement.textContent = `Selected: "${cardData.name}".`;
        }

        function updateUI(animateCards = false) {
            if (player) {
                playerHandElement.innerHTML = '';
                player.hand.forEach((card, index) => playerHandElement.appendChild(renderCard(card, true, index)));

                playerSuspicionBar.style.width = `${(player.suspicion / MAX_PLAYER_SUSPICION) * 100}%`;
                playerSuspicionText.textContent = `${Math.floor(player.suspicion)} / ${MAX_PLAYER_SUSPICION}`;
                
                playerSuppliesBar.style.width = `${(player.supplies / MAX_SUPPLIES) * 100}%`;
                playerSuppliesText.textContent = `${Math.floor(player.supplies)} / ${MAX_SUPPLIES}`;

                playerDeckCountElement.textContent = player.deck.length;
                playerDiscardCountElement.textContent = player.discardPile.length;

                playerDeckVisualElement.classList.toggle('hidden', player.deck.length === 0);
                playerDiscardVisualElement.classList.toggle('hidden', player.discardPile.length === 0);
            }

            if (opponent) {
                const regimeStrengthPercent = (opponent.suspicion / MAX_REGIME_STRENGTH) * 100;
                opponentStrengthBar.style.width = `${regimeStrengthPercent}%`;
                opponentStrengthText.textContent = `${Math.floor(regimeStrengthPercent)}%`;
                opponentName.textContent = `Opponent: Trujillo (Strength: ${Math.floor(opponent.suspicion)})`;

                opponentHandElement.innerHTML = '';
                // Render opponent cards visible
                opponent.hand.forEach((card, index) => opponentHandElement.appendChild(renderCard(card, false, index)));
            }
            
            checkGameOver();
        }

        function showMessageBox(message, buttonText, buttonAction) {
            gameActive = false;
            messageText.textContent = message;
            messageBoxButton.textContent = buttonText;
            messageBoxButton.onclick = () => {
                messageBox.classList.add('hidden');
                if (buttonAction === startGame) {
                    gameScreen.classList.add('hidden');
                }
                buttonAction();
            };
            messageBox.classList.remove('hidden');
            gameScreen.classList.add('hidden');
            // Pause music when message box is shown
            backgroundMusic.pause();
        }

        function checkGameOver() {
            if (player && opponent) {
                if (player.suspicion >= MAX_PLAYER_SUSPICION) {
                    showMessageBox('The regime\'s suspicion became too great. You are captured. The resistance crumbles.', 'Restart Game', startGame);
                    gameActive = false;
                    return true;
                }
                if (player.supplies <= 0 && player.hand.every(card => card.cost > 0)) {
                    showMessageBox('Your supplies ran out with no way to recover. The resistance cannot continue.', 'Restart Game', startGame);
                    gameActive = false;
                    return true;
                }
                if (opponent.suspicion <= 0) {
                    showMessageBox('The regime\'s strength has been completely eroded. Trujillo is overthrown! The butterflies have prevailed!', 'Play Again', startGame);
                    gameActive = false;
                    return true;
                }
            }
            return false;
        }

        // --- Event Listeners ---
        startButton.addEventListener('click', startGame);
        playCardButton.addEventListener('click', playSelectedCard);
        endTurnButton.addEventListener('click', endTurn);

        document.addEventListener('DOMContentLoaded', () => {
            gameScreen.classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
            if (playerDeckCountElement && playerDiscardCountElement) {
                playerDeckCountElement.textContent = '0';
                playerDiscardCountElement.textContent = '0';
                playerDeckVisualElement.classList.add('hidden');
                playerDiscardVisualElement.classList.add('hidden');
            }
        });

    </script>
</body>
</html>

